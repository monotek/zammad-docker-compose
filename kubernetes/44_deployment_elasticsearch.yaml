apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: zammad-elasticsearch
  namespace: zammad
  labels:
    component: database
    app: elasticsearch
spec:
  serviceName: zammad-elasticsearch
  replicas: 1
  template:
    metadata:
      labels:
        component: searchindex
        app: elasticsearch
    spec:
      terminationGracePeriodSeconds: 10
      volumes:
      - name: zammad-elasticsearch
        persistentVolumeClaim:
          claimName: zammad-elasticsearch

      initContainers:
      - name: sysctl
        image: busybox
        command: ["sysctl", "-w", "vm.max_map_count=262144"]
        securityContext:
          privileged: true

      containers:
      - name: zammad-elasticsearch
        image: monotek/zammad-docker-compose:zammad-elasticsearch
        ports:
        - name: elasticsearch
          containerPort: 9200
        imagePullPolicy: Always
        volumeMounts:
        - name: zammad-elasticsearch
          mountPath: /usr/share/elasticsearch/data
